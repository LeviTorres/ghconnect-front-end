<h1><strong>Nueva solicitud de Seguros/Fianzas</strong></h1>
<form autocomplete="off" [formGroup]="travelForm">
  <div class="row d-flex align-items-center">
    <div class="col-4">
      <h2><strong>Datos de poliza</strong></h2>
    </div>
    <div class="col-8 row">
      <div class="col-6">
        <label>Fecha de creacion</label>
        <mat-form-field class="w-100" appearance="outline">
          <input
            matInput
            [matDatepicker]="picker1"
            placeholder="Selecciona una fecha"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="picker1"
          ></mat-datepicker-toggle>
          <mat-datepicker #picker1></mat-datepicker>
        </mat-form-field>
      </div>
      <div class="col-6">
        <label>Fecha de emision</label>
        <mat-form-field class="w-100" appearance="outline">
          <input
            matInput
            [matDatepicker]="picker4"
            placeholder="Selecciona una fecha"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="picker4"
          ></mat-datepicker-toggle>
          <mat-datepicker #picker4></mat-datepicker>
        </mat-form-field>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-3">
      <label>Numero de poliza</label>
      <mat-form-field class="w-100" appearance="outline">
        <input
          matInput
          placeholder="Escribe el codigo de empleado"
        />
        <mat-error
          *ngIf="travelForm.controls['key_employee'].hasError('required')"
        >
          Campo requerido
        </mat-error>
      </mat-form-field>
    </div>
    <div class="col-3">
      <label>Tipo de poliza</label>
      <mat-form-field class="w-100" appearance="outline">
        <input
          matInput
          placeholder="Selecciona el tipo de poliza"
        />
        <mat-error
          *ngIf="travelForm.controls['name_applicant'].hasError('required')"
        >
          Campo requerido
        </mat-error>
      </mat-form-field>
    </div>
    <div class="col-3">
      <label>Ceco</label>
      <mat-form-field class="w-100" appearance="outline">
        <mat-select
          matInput
          placeholder="Escribe el Ceco"
        >
          <mat-option *ngFor="let item of cecos" [value]="item._id">{{item.
            key_ceco_business}} - {{
            item.name_short
          }}</mat-option>
        </mat-select>
        <mat-error *ngIf="travelForm.controls['business'].hasError('required')">
          Campo requerido
        </mat-error>
      </mat-form-field>
    </div>
    <div class="col-3">
      <label>Empresa</label>
      <mat-form-field class="w-100" appearance="outline">
        <input
          matInput
          placeholder="Nombre empresa"
        />
        <mat-error
          *ngIf="travelForm.controls['cost_center'].hasError('required')"
        >
          Campo requerido
        </mat-error>
      </mat-form-field>
    </div>
  </div>
  <div class="row d-flex align-items-center">
    <div class="col-3">
      <div>
        <label>Ordenante</label>
        <mat-form-field class="w-100" appearance="outline">
          <input
          matInput
          placeholder="Selecciona el ordenante"
        />
        <mat-error
          *ngIf="travelForm.controls['name_applicant'].hasError('required')"
        >
          Campo requerido
        </mat-error>
        </mat-form-field>
      </div>
    </div>
    <div class="col-3">
      <div>
        <label>Beneficiario</label>
        <mat-form-field class="w-100" appearance="outline">
          <input
          matInput
          placeholder="Escribe el nombre del beneficiario"
        />
        <mat-error
          *ngIf="travelForm.controls['name_applicant'].hasError('required')"
        >
          Campo requerido
        </mat-error>
        </mat-form-field>
      </div>
    </div>
    <div class="col-3">
      <div>
        <label>Valor contrato principal</label>
        <mat-form-field class="w-100" appearance="outline">
          <input
          matInput
          placeholder="$000,000,000.00"
          />
          <mat-error
            *ngIf="travelForm.controls['cost_center'].hasError('required')"
          >
            Campo requerido
          </mat-error>
        </mat-form-field>
      </div>
    </div>
    <div class="col-3">
      <div>
        <label>Divisa contrato principal</label>
        <mat-form-field class="w-100" appearance="outline">
          <mat-select
          matInput
          placeholder="Selecciona la divisa del contrato"
          >
            <mat-option *ngFor="let item of divisas" [value]="item._id">{{item.abbreviation_divisa}}</mat-option>
          </mat-select>
          <mat-error
            *ngIf="travelForm.controls['cost_center'].hasError('required')"
          >
            Campo requerido
          </mat-error>
        </mat-form-field>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-3">
      <label>Suma garantizada</label>
      <mat-form-field class="w-100" appearance="outline">
        <input
          matInput
          placeholder="$000,000,000.00"
        />
        <mat-error
          *ngIf="travelForm.controls['reason_trip'].hasError('required')"
        >
          Campo requerido
        </mat-error>
      </mat-form-field>
    </div>
    <div class="col-3">
      <label>Divisa de suma garantizada</label>
      <mat-form-field class="w-100" appearance="outline">
        <mat-select
        matInput
        placeholder="Selecciona la divisa del contrato"
        >
          <mat-option *ngFor="let item of divisas" [value]="item._id">{{item.abbreviation_divisa}}</mat-option>
        </mat-select>
        <mat-error
          *ngIf="travelForm.controls['cost_center'].hasError('required')"
        >
          Campo requerido
        </mat-error>
      </mat-form-field>
    </div>
    <div class="col-6">
      <label>Valor de equivalencia contrato principal</label>
      <mat-form-field class="w-100" appearance="outline">
        <input
          matInput
          placeholder="Equivalente al 7% (Siete/cien por ciento) del contrato principal"
        />
        <mat-error
          *ngIf="travelForm.controls['reason_trip'].hasError('required')"
        >
          Campo requerido
        </mat-error>
      </mat-form-field>
    </div>
  </div>
  <div class="row">
    <div class="col-3">
      <label>Inicio vigencia</label>
      <mat-form-field class="w-100" appearance="outline">
        <input
        matInput
        [matDatepicker]="picker3"
        placeholder="Selecciona una fecha"
        />
        <mat-datepicker-toggle
          matSuffix
          [for]="picker3"
        ></mat-datepicker-toggle>
        <mat-datepicker #picker3></mat-datepicker>
        <mat-error
          *ngIf="travelForm.controls['departure_date'].hasError('required')"
        >
          Campo requerido
        </mat-error>
      </mat-form-field>
    </div>
    <div class="col-3">
      <label>Fin vigencia</label>
      <mat-form-field class="w-100" appearance="outline">
        <input
        matInput
        [matDatepicker]="picker2"
        placeholder="Selecciona una fecha"
        />
        <mat-datepicker-toggle
          matSuffix
          [for]="picker2"
        ></mat-datepicker-toggle>
        <mat-datepicker #picker2></mat-datepicker>
        <mat-error
          *ngIf="travelForm.controls['return_date'].hasError('required')"
        >
          Campo requerido
        </mat-error>
      </mat-form-field>
    </div>
    <div class="col-6">
      <label>Vigencia de poliza</label>
      <mat-form-field class="w-100" appearance="outline">
        <input
          matInput
        />
        <mat-error
          *ngIf="travelForm.controls['reason_trip'].hasError('required')"
        >
          Campo requerido
        </mat-error>
      </mat-form-field>
    </div>
  </div>
  <div class="row">
    <div class="col-8">
      <label>Objeto del seguro/fianza</label>
      <mat-form-field class="w-100" appearance="outline">
        <input
          matInput
          placeholder="Escribe el objeto del beneficiario"
        />
        <mat-error
          *ngIf="travelForm.controls['reason_trip'].hasError('required')"
        >
          Campo requerido
        </mat-error>
      </mat-form-field>
    </div>
    <div class="col-4">
      <label>Procedimiento de ejecucion</label>
      <mat-form-field class="w-100" appearance="outline">
        <input
          matInput
          placeholder="Renovable, irrevocable y primer req."
        />
        <mat-error
          *ngIf="travelForm.controls['reason_trip'].hasError('required')"
        >
          Campo requerido
        </mat-error>
      </mat-form-field>
    </div>
  </div>
  <div class="row">
    <div class="col-3">
      <label>Prima a pagar</label>
      <mat-form-field class="w-100" appearance="outline">
        <input
          matInput
          placeholder="$000,000,000.00"
        />
        <mat-error
          *ngIf="travelForm.controls['reason_trip'].hasError('required')"
        >
          Campo requerido
        </mat-error>
      </mat-form-field>
    </div>
    <div class="col-3">
      <label>Condiciones de pago</label>
      <mat-form-field class="w-100" appearance="outline">
        <input
          matInput
          placeholder="$000,000,000.00"
        />
        <mat-error
          *ngIf="travelForm.controls['reason_trip'].hasError('required')"
        >
          Campo requerido
        </mat-error>
      </mat-form-field>
    </div>
  </div>
  <div class="d-flex">
    <div>
      <h1 class="my-3"><strong>Documento</strong></h1>
    </div>
    <div>
      <button class="btn-primary mx-3"  mat-raised-button>
        Anadir documento
      </button>
    </div>
  </div>
  <div class="row">
    <h1 class="my-3"><strong>Notificaciones</strong></h1>
  </div>
  <div class="row mb-5">
    <div class="col-6">
      <div class="table-responsive" *ngIf="!addUser">
        <table class="table text-nowrap">
          <thead>
            <tr>
              <th class="last">Autorizador</th>
              <th class="last">Requerido</th>
              <th class="last">Status</th>
              <th class="last">Acciones</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let authorizer of authorizers; index as i">
              <td>
                <span>{{ getEmailAuthorizer(authorizer.user) }}</span>
              </td>
              <td class="text-center">
                <mat-checkbox
                  class="mb-4"
                  disabled
                  [checked]="authorizer.required"
                ></mat-checkbox>
              </td>
              <td>
                <p class="mb-3">Por enviar</p>
              </td>
              <td>
                <!--<i class="fa fa-edit me-4" (click)="openDialogEditDivisa(divisa)"></i>-->
                <i class="fa fa-trash" (click)="delete(i)"></i>
              </td>
              <td></td>
            </tr>
            <td
              style="color: var(--tblr-blue); cursor: pointer"
              class="text-center py-2"
              (click)="addRow()"
            >
              Añadir autorizador
            </td>
          </tbody>
        </table>
      </div>
      <div *ngIf="addUser" class="card p-4">
        <form
          (ngSubmit)="registerUser()"
          autocomplete="off"
          [formGroup]="userForm"
        >
          <div class="row">
            <div class="col-8">
              <label
                >Escribe el nombre o correo electronico del autorizador</label
              >
              <mat-form-field class="w-100" appearance="outline">
                <input
                  type="text"
                  class="w-100"
                  matInput
                  formControlName="user"
                  [matAutocomplete]="search"
                  placeholder="Ingresa un usuario"
                />
                <mat-autocomplete
                  autoActiveFirstOption
                  #search="matAutocomplete"
                  [displayWith]="displayFn"
                >
                  <mat-option value="" *ngIf="!userForm.controls['user'].value">
                    Escribe algo...
                  </mat-option>
                  <mat-option
                    value="{{ userForm.controls['user'].value }}"
                    (click)="createUser(userForm.controls['user'].value)"
                    *ngIf="userForm.controls['user'].value && !validate_user"
                  >
                    Crear usuario {{ userForm.controls["user"].value }}
                  </mat-option>
                  <div *ngIf="userForm.controls['user'].value">
                    <mat-option
                      *ngFor="let option of filteredOptions"
                      [value]="option"
                    >
                      {{ option.email }} ({{ option.name }}
                      {{ option.last_name }})</mat-option
                    >
                  </div>
                  <!-- <mat-option
                    value=""
                    *ngIf="
                      filteredOptions.length <= 0 &&
                      this.userForm.controls['user'].value &&
                      !validate_user
                    "
                  >
                    No se encontró nada con el término:
                    {{ userForm.controls["user"].value }}
                  </mat-option> -->
                </mat-autocomplete>
                <mat-error
                  *ngIf="userForm.controls['user'].hasError('required')"
                >
                  Campo requerido
                </mat-error>
              </mat-form-field>
            </div>
            <div class="col-3 d-flex flex-column text-center">
              <label>Requerido</label>
              <mat-checkbox formControlName="required"></mat-checkbox>
            </div>
            <div class="col-1 d-flex justify-content-end">
              <i class="fa-light fa-xmark fa" (click)="returnTable()"></i>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <label>Escribele un mensaje al autorizador</label>
              <mat-form-field class="w-100" appearance="outline">
                <textarea
                  matInput
                  formControlName="message"
                  placeholder="Describe tu solicitud"
                ></textarea>
              </mat-form-field>
            </div>
          </div>
          <div class="row d-flex justify-content-center">
            <button class="btn-primary w-75" mat-raised-button>
              Añadir autorizador
            </button>
          </div>
        </form>
      </div>
    </div>
    <div class="col-6">
      <div style="height: 100px" class="card p-3">
        <span class="mb-2"><strong>Actividad reciente</strong></span>
        <div *ngIf="this.users.length > 0">
          <p>
            {{ date | date: "dd/MM/yyyy h:mm a" }} - {{ getUser()!.name }}
            {{ getUser()!.last_name }} - Creando una nueva solicitud de viaje...
          </p>
        </div>
      </div>
    </div>
  </div>
  <div class="text-center">
    <button
      class="btn-primary mx-3"
      (click)="registerTravel()"
      mat-raised-button
    >
      Guardar solicitud
    </button>
    <button class="btn-primary mx-3" (click)="sendRequest()" mat-raised-button>
      Enviar solicitud
    </button>
  </div>
</form>
